# Claude Code Resume Context - WOPR Project

## Last Updated: 2026-01-20

## Project Location
`/home/corey/source/repos/personal/WOPR`

## Current State
**Branch:** `main`
**Commit:** `6b95a13`
**Status:** Clean, all features merged

### Recent Work Completed (This Session):
1. **Comprehensive Regression Testing**:
   - All 76 pytest unit tests passing
   - All 16 games pass individual regression testing
   - Verified GTW changes isolated - no impact on other games

2. **Test Suite Fixes**:
   - Fixed `test_map_markers` -> `test_map_missiles` to use new WorldMap API
   - Fixed `test_learning_demonstration` assertion to match actual output format

3. **Documentation Updates**:
   - Updated `.claude-resume.md` with current project state
   - Verified `README.md` is current with GTW features

4. **Branch Management**:
   - Merged `feature/gtw3` to `main`
   - Deleted `feature/gtw3` branch (local and remote)

### GTW Visual Enhancements (Now on Main):
- Drawille braille library for high-resolution missile arc rendering
- Red missile trails using Textual markup
- Red X impact markers for nuclear strike locations
- Single-map animation with clear_callback (smooth animation)
- Arc space (8 character rows) above map for full trajectory visibility

## Test Status
| Suite | Result |
|-------|--------|
| Pytest (76 tests) | 76/76 PASS |
| Game Regression (16 games) | 16/16 PASS |

## Key Files
- `wopr/games/military/thermonuclear_war/drawille_map.py` - Drawille braille map rendering
- `wopr/games/military/thermonuclear_war/game.py` - GTW game with clear_callback
- `wopr/games/military/thermonuclear_war/map.py` - WorldMap with missile system
- `wopr/app.py` - Main app, passes clear_callback to GTW
- `tests/test_games/test_gtw.py` - GTW tests (updated API)
- `tests/test_games/test_tictactoe.py` - TicTacToe tests (fixed assertion)

## Technical Notes

### Drawille Implementation (for GTW missile arcs):
```python
# Key concepts for missile arc rendering:

# 1. Coordinate System with Arc Space
Y_OFFSET = 32      # Pixels to shift coordinates down
ARC_ROWS = 8       # Character rows above map for arc display
CANVAS_HEIGHT = 128  # Extended canvas height

# 2. All city LOCATIONS have Y coordinates shifted by Y_OFFSET
"MOSCOW": (110, 44),  # Original y=12, shifted by 32

# 3. canvas.frame() alignment (CRITICAL)
# Drawille's canvas.frame() only returns rows WITH content
# Track min_y and use as offset when overlaying
min_y_char = min_y_pixel // 4
actual_row = dy + min_y_char

# 4. Textual markup escaping (NOT like Rich)
# Use \[ to escape brackets, not [[
```

### WorldMap API:
```python
# Adding missiles
missile = world_map.add_missile("US_CENTER", "MOSCOW", side="US")

# Checking state
world_map.has_active_missiles()
len(world_map._missiles)  # Note: private attribute

# Advancing animation
world_map.advance_all()

# Clearing
world_map.clear_missiles()
```

## Repository Info
- **GitHub:** https://github.com/c88951/WOPR
- **Main branch:** `main` (all features merged)

## Cleanup Notes
- `wopr/assets/maps/world_ascii.txt` is unused - can be deleted if desired
- `prototype_map.py` in root is untracked scratch file - can be deleted

## Resume Instructions
Tell Claude: "Resume from .claude-resume.md in the WOPR project"
